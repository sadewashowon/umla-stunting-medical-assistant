"""
Stunting Knowledge Base Module
Contains comprehensive information about stunting for the medical assistant chatbot
Supports both English and Indonesian languages
"""

# Comprehensive stunting knowledge base in Indonesian
STUNTING_KNOWLEDGE_ID = {
    "apa_itu_stunting": {
        "title": "Apa itu Stunting?",
        "content": """
        **Stunting** adalah kondisi di mana tinggi badan anak secara signifikan di bawah rata-rata untuk usianya. 
        Ini adalah bentuk malnutrisi yang mempengaruhi perkembangan fisik dan kognitif.
        
        **Karakteristik Utama:**
        - Tinggi-untuk-usia di bawah -2 standar deviasi dari standar pertumbuhan WHO
        - Biasanya terjadi dalam 1000 hari pertama kehidupan (konsepsi hingga usia 2 tahun)
        - Dapat memiliki efek jangka panjang pada kesehatan, pendidikan, dan produktivitas ekonomi
        - Sering tidak dapat diubah setelah usia 2-3 tahun
        
        **Dampak Global:**
        - Mempengaruhi sekitar 1 dari 4 anak di bawah 5 tahun secara global
        - Paling umum di Asia Selatan dan Sub-Sahara Afrika
        - Berkontribusi pada siklus kemiskinan antar generasi
        """,
        "keywords": ["apa itu", "definisi", "jelaskan", "stunting", "malnutrisi", "pendek", "kerdil"]
    },
    
    "penyebab": {
        "title": "Penyebab Stunting",
        "content": """
        Stunting terjadi karena interaksi kompleks dari berbagai faktor:
        
        **1. Faktor Nutrisi:**
        - **Asupan protein tidak memadai**: Penting untuk pertumbuhan dan perkembangan
        - **Kekurangan mikronutrien**: Zat besi, seng, vitamin A, yodium
        - **Praktik menyusui yang buruk**: Inisiasi terlambat, penghentian dini
        - **Makanan pendamping tidak memadai**: Kualitas dan kuantitas buruk setelah 6 bulan
        
        **2. Faktor Lingkungan:**
        - **Sanitasi dan kebersihan yang buruk**: Menyebabkan infeksi yang sering
        - **Akses air bersih terbatas**: Berkontribusi pada penyakit yang ditularkan melalui air
        - **Kondisi perumahan tidak memadai**: Kepadatan, ventilasi buruk
        - **Ketahanan pangan**: Akses yang tidak dapat diandalkan ke makanan bergizi
        
        **3. Faktor Maternal:**
        - **Nutrisi maternal yang buruk**: Sebelum dan selama kehamilan
        - **Kehamilan remaja**: Risiko komplikasi yang lebih tinggi
        - **Interval kelahiran pendek**: Kurang dari 18 bulan antara kehamilan
        - **Infeksi maternal**: HIV, malaria, tuberkulosis
        
        **4. Faktor Perawatan Kesehatan:**
        - **Akses terbatas ke perawatan kesehatan**: Perawatan prenatal dan postnatal
        - **Imunisasi tidak memadai**: Peningkatan risiko infeksi
        - **Pemantauan pertumbuhan yang buruk**: Kesempatan intervensi dini terlewat
        """,
        "keywords": ["penyebab", "mengapa", "alasan", "faktor", "menyebabkan", "mengakibatkan", "kenapa"]
    },
    
    "pencegahan": {
        "title": "Mencegah Stunting",
        "content": """
        Mencegah stunting memerlukan pendekatan komprehensif dan multi-sektoral:
        
        **Selama Kehamilan (1000 Hari Pertama - Konsepsi hingga Kelahiran):**
        - **Nutrisi maternal yang memadai**: Diet seimbang dengan kalori dan protein yang cukup
        - **Perawatan prenatal rutin**: Minimal 4 kunjungan selama kehamilan
        - **Suplemen zat besi dan asam folat**: Harian selama 6+ bulan
        - **Kenaikan berat badan yang memadai**: 11-16 kg untuk wanita dengan BMI normal
        - **Pencegahan penyakit**: Pencegahan malaria, pemberian obat cacing
        
        **Setelah Kelahiran (0-6 bulan):**
        - **Menyusui eksklusif**: Hanya ASI selama 6 bulan pertama
        - **Inisiasi dini**: Dalam 1 jam setelah kelahiran
        - **Pemberian makan yang sering**: Sesuai permintaan, 8-12 kali per hari
        - **Posisi yang tepat**: Pastikan transfer ASI yang efektif
        
        **6-24 bulan (Makanan Pendamping):**
        - **Pengenalan tepat waktu**: Mulai pada 6 bulan, tidak sebelum atau sesudah
        - **Frekuensi yang memadai**: 2-3 kali makan per hari pada 6-8 bulan, 3-4 kali pada 9-24 bulan
        - **Variasi makanan**: Termasuk protein, buah, sayuran, biji-bijian
        - **Keamanan makanan**: Persiapan dan penyimpanan yang bersih
        - **Menyusui berkelanjutan**: Hingga 2 tahun atau lebih
        
        **Tingkat Komunitas dan Kebijakan:**
        - **Akses air bersih dan sanitasi**: Mengurangi risiko infeksi
        - **Program pendidikan kesehatan**: Kesadaran nutrisi dan kebersihan
        - **Pengurangan kemiskinan**: Pemberdayaan ekonomi keluarga
        - **Fortifikasi makanan**: Menambahkan nutrisi ke makanan pokok
        - **Perlindungan sosial**: Transfer tunai, program bantuan makanan
        """,
        "keywords": ["cegah", "hindari", "hentikan", "bagaimana", "perlindungan", "intervensi", "mencegah"]
    },
    
    "pengobatan": {
        "title": "Pengobatan dan Penanganan Stunting",
        "content": """
        Meskipun stunting sering tidak dapat diubah setelah usia 2-3 tahun, intervensi dini dapat memperbaiki hasil:
        
        **1. Rehabilitasi Nutrisi:**
        - **Diet tinggi protein dan kalori**: 120-150% dari kebutuhan normal
        - **Suplemen mikronutrien**: Zat besi, seng, vitamin A, yodium
        - **Program pemberian makan terapeutik**: Makanan terapeutik siap pakai (RUTF)
        - **Makan kecil yang sering**: 5-6 kali makan per hari untuk penyerapan yang lebih baik
        
        **2. Perawatan Medis:**
        - **Pengobatan infeksi yang mendasari**: Antibiotik, antiparasit
        - **Penanganan komplikasi**: Anemia, defisiensi vitamin
        - **Pemantauan kesehatan rutin**: Pelacakan pertumbuhan, penilaian perkembangan
        - **Imunisasi catch-up**: Jadwal vaksinasi yang lengkap
        
        **3. Dukungan Jangka Panjang:**
        - **Dukungan nutrisi berkelanjutan**: Pemantauan dan suplemen rutin
        - **Pemantauan perkembangan**: Penilaian perkembangan kognitif dan motorik
        - **Pendidikan dan konseling keluarga**: Praktik nutrisi, kebersihan, perawatan
        - **Program kesiapan sekolah**: Dukungan perkembangan anak usia dini
        
        **4. Pertimbangan Khusus:**
        - **Malnutrisi akut berat**: Memerlukan perhatian medis segera
        - **Kondisi kronis**: HIV, tuberkulosis, kelainan bawaan
        - **Dukungan keluarga**: Mengatasi hambatan sosial dan ekonomi
        - **Integrasi komunitas**: Mengurangi stigma dan diskriminasi
        
        **Catatan Penting:**
        - Intervensi dini (sebelum usia 2) sangat penting untuk hasil yang lebih baik
        - Pengobatan memerlukan komitmen dan dukungan jangka panjang
        - Pencegahan lebih efektif dan hemat biaya daripada pengobatan
        - Keterlibatan keluarga dan komunitas sangat penting untuk keberhasilan
        """,
        "keywords": ["obati", "sembuhkan", "perbaiki", "bantu", "penanganan", "intervensi", "terapi", "pengobatan"]
    },
    
    "pemantauan_pertumbuhan": {
        "title": "Pemantauan Pertumbuhan dan Penilaian",
        "content": """
        Pemantauan pertumbuhan rutin sangat penting untuk deteksi dini dan intervensi:
        
        **Kartu Pertumbuhan:**
        - **Standar Pertumbuhan WHO**: Referensi internasional untuk anak 0-5 tahun
        - **Tinggi-untuk-usia**: Indikator utama untuk stunting
        - **Berat-untuk-tinggi**: Indikator malnutrisi akut
        - **Lingkar kepala**: Indikator perkembangan otak
        
        **Frekuensi Pengukuran:**
        - **Lahir hingga 6 bulan**: Pengukuran bulanan
        - **6-12 bulan**: Setiap 2 bulan
        - **1-2 tahun**: Setiap 3 bulan
        - **2-5 tahun**: Setiap 6 bulan
        
        **Tanda Bahaya:**
        - **Kurva pertumbuhan menurun**: Melintasi persentil ke bawah
        - **Tinggi-untuk-usia < -2 SD**: Stunting sedang
        - **Tinggi-untuk-usia < -3 SD**: Stunting berat
        - **Tidak ada kenaikan tinggi**: Selama 3+ bulan
        
        **Alat Penilaian:**
        - **Lingkar lengan atas tengah (MUAC)**: Alat skrining cepat
        - **Indeks massa tubuh (BMI)**: Untuk anak yang lebih besar
        - **Tahapan perkembangan**: Keterampilan motorik, kognitif, sosial
        """,
        "keywords": ["pertumbuhan", "pemantauan", "pengukuran", "penilaian", "kartu", "persentil", "tinggi", "berat"]
    },
    
    "panduan_nutrisi": {
        "title": "Panduan Nutrisi untuk Pencegahan",
        "content": """
        Rekomendasi nutrisi berbasis bukti untuk mencegah stunting:
        
        **Nutrisi Kehamilan:**
        - **Kalori**: Tambahan 300-500 kcal/hari pada trimester ke-2 dan ke-3
        - **Protein**: 1,1 g/kg berat badan (vs 0,8 g/kg biasanya)
        - **Zat besi**: Suplemen 30 mg/hari
        - **Asam folat**: 400-800 mcg/hari
        - **Kalsium**: 1000-1300 mg/hari
        
        **Pemberian Makan Bayi (0-6 bulan):**
        - **Menyusui eksklusif**: Tidak ada makanan atau cairan lain
        - **Frekuensi**: 8-12 kali per hari, sesuai permintaan
        - **Durasi**: Minimal 6 bulan
        - **Nutrisi maternal**: Pastikan asupan yang memadai untuk produksi ASI
        
        **Makanan Pendamping (6-24 bulan):**
        - **Mulai pada 6 bulan**: Tidak sebelum, tidak sesudah
        - **Kelompok makanan**: Biji-bijian, kacang-kacangan, daging/ikan, susu, buah, sayuran
        - **Progresi tekstur**: Puree → lumat → cincang → makanan jari
        - **Makanan kaya zat besi**: Daging, ikan, sereal fortifikasi, kacang-kacangan
        - **Sumber vitamin A**: Buah dan sayuran oranye/kuning
        
        **Nutrisi Utama:**
        - **Protein**: 1,6 g/kg/hari untuk 6-12 bulan, 1,2 g/kg/hari untuk 1-3 tahun
        - **Zat besi**: 11 mg/hari untuk 7-12 bulan, 7 mg/hari untuk 1-3 tahun
        - **Seng**: 3 mg/hari untuk 7-12 bulan, 3 mg/hari untuk 1-3 tahun
        - **Vitamin A**: 400-500 mcg/hari
        """,
        "keywords": ["nutrisi", "diet", "makanan", "menyusui", "pendamping", "gizi", "vitamin", "protein"]
    },
    
    "faktor_risiko": {
        "title": "Faktor Risiko Stunting",
        "content": """
        Memahami faktor risiko membantu mengidentifikasi anak yang memerlukan perhatian ekstra:
        
        **Faktor Risiko Individual:**
        - **Berat lahir rendah**: <2,5 kg saat lahir
        - **Prematuritas**: Lahir sebelum 37 minggu kehamilan
        - **Kelahiran ganda**: Kembar, triplet
        - **Kondisi bawaan**: Cacat jantung, kelainan genetik
        - **Infeksi yang sering**: Diare, infeksi saluran pernapasan
        
        **Faktor Risiko Keluarga:**
        - **Status sosial ekonomi rendah**: Kemiskinan, ketahanan pangan
        - **Ukuran keluarga besar**: Banyak anak, interval kelahiran pendek
        - **Pendidikan maternal**: Kurang dari pendidikan menengah
        - **Rumah tangga orang tua tunggal**: Dukungan dan sumber daya terbatas
        - **Riwayat keluarga**: Stunting pada saudara kandung atau orang tua
        
        **Faktor Risiko Komunitas:**
        - **Tempat tinggal pedesaan**: Akses terbatas ke perawatan kesehatan dan pasar
        - **Infrastruktur buruk**: Air, sanitasi, jalan tidak memadai
        - **Perawatan kesehatan terbatas**: Sedikit fasilitas, jarak tempuh jauh
        - **Ketahanan pangan**: Kekurangan musiman, fluktuasi harga
        - **Bencana alam**: Kekeringan, banjir, konflik
        
        **Faktor Risiko Lingkungan:**
        - **Perubahan iklim**: Mempengaruhi produksi dan ketahanan pangan
        - **Kelangkaan air**: Akses terbatas ke air bersih
        - **Polusi udara**: Dampak kesehatan pernapasan
        - **Penyakit yang ditularkan vektor**: Malaria, demam berdarah
        """,
        "keywords": ["risiko", "faktor", "rentan", "berisiko tinggi", "rentan", "berisiko"]
    },
    
    "tanda_peringatan_dini": {
        "title": "Tanda Peringatan Dini Stunting",
        "content": """
        Mengenali tanda peringatan dini memungkinkan intervensi tepat waktu:
        
        **Tanda Fisik:**
        - **Pertumbuhan lambat**: Tidak bertambah tinggi seperti yang diharapkan
        - **Kecil untuk usianya**: Konsisten di bawah persentil kartu pertumbuhan
        - **Tahapan perkembangan tertunda**: Duduk, berdiri, berjalan lebih lambat dari teman sebaya
        - **Tonus otot buruk**: Tampak lemah, lemas
        - **Ekstremitas tipis**: Lengan dan kaki tampak tipis
        
        **Tanda Perilaku:**
        - **Aktivitas menurun**: Kurang bermain, lebih lelah
        - **Nafsu makan buruk**: Tidak tertarik pada makanan
        - **Sering menangis**: Mudah marah, sulit ditenangkan
        - **Masalah tidur**: Kesulitan tidur atau tidur berlebihan
        - **Penarikan sosial**: Kurang interaksi dengan orang lain
        
        **Keterlambatan Perkembangan:**
        - **Keterampilan motorik**: Terlambat berguling, duduk, merangkak, berjalan
        - **Bahasa**: Perkembangan bicara tertunda
        - **Keterampilan sosial**: Kontak mata buruk, interaksi sosial terbatas
        - **Kognitif**: Kesulitan mempelajari keterampilan baru
        
        **Kapan Mencari Bantuan:**
        - **Tidak ada kenaikan tinggi**: Selama 3+ bulan berturut-turut
        - **Kurva pertumbuhan menurun**: Melintasi persentil ke bawah
        - **Banyak keterlambatan**: Fisik, kognitif, dan sosial
        - **Kekhawatiran keluarga**: Orang tua memperhatikan ada yang salah
        - **Faktor risiko hadir**: Banyak faktor risiko teridentifikasi
        """,
        "keywords": ["peringatan", "tanda", "gejala", "dini", "deteksi", "pengenalan", "awal"]
    }
}

# English knowledge base (existing)
STUNTING_KNOWLEDGE = {
    "what_is_stunting": {
        "title": "What is Stunting?",
        "content": """
        **Stunting** is a condition where a child's height is significantly below the average for their age. 
        It's a form of malnutrition that affects physical and cognitive development.
        
        **Key Characteristics:**
        - Height-for-age below -2 standard deviations from WHO growth standards
        - Usually occurs in the first 1000 days of life (conception to age 2)
        - Can have long-term effects on health, education, and economic productivity
        - Often irreversible after age 2-3 years
        
        **Global Impact:**
        - Affects approximately 1 in 4 children under 5 globally
        - Most prevalent in South Asia and Sub-Saharan Africa
        - Contributes to intergenerational cycles of poverty
        """,
        "keywords": ["definition", "what is", "explain", "stunting", "malnutrition"]
    },
    
    "causes": {
        "title": "Causes of Stunting",
        "content": """
        Stunting results from a complex interplay of multiple factors:
        
        **1. Nutritional Factors:**
        - **Inadequate protein intake**: Essential for growth and development
        - **Micronutrient deficiencies**: Iron, zinc, vitamin A, iodine
        - **Poor breastfeeding practices**: Delayed initiation, early cessation
        - **Insufficient complementary feeding**: Poor quality and quantity after 6 months
        
        **2. Environmental Factors:**
        - **Poor sanitation and hygiene**: Leads to frequent infections
        - **Limited access to clean water**: Contributes to waterborne diseases
        - **Inadequate housing conditions**: Crowding, poor ventilation
        - **Food insecurity**: Unreliable access to nutritious food
        
        **3. Maternal Factors:**
        - **Poor maternal nutrition**: Before and during pregnancy
        - **Teenage pregnancy**: Higher risk of complications
        - **Short birth intervals**: Less than 18 months between pregnancies
        - **Maternal infections**: HIV, malaria, tuberculosis
        
        **4. Healthcare Factors:**
        - **Limited access to healthcare**: Prenatal and postnatal care
        - **Inadequate immunization**: Increased risk of infections
        - **Poor growth monitoring**: Missed opportunities for early intervention
        """,
        "keywords": ["cause", "why", "reason", "factor", "lead to", "result in"]
    },
    
    "prevention": {
        "title": "Preventing Stunting",
        "content": """
        Preventing stunting requires a comprehensive, multi-sectoral approach:
        
        **During Pregnancy (First 1000 Days - Conception to Birth):**
        - **Adequate maternal nutrition**: Balanced diet with sufficient calories and protein
        - **Regular prenatal care**: At least 4 visits during pregnancy
        - **Iron and folic acid supplementation**: Daily for 6+ months
        - **Adequate weight gain**: 11-16 kg for normal BMI women
        - **Disease prevention**: Malaria prevention, deworming
        
        **After Birth (0-6 months):**
        - **Exclusive breastfeeding**: Only breast milk for first 6 months
        - **Early initiation**: Within 1 hour of birth
        - **Frequent feeding**: On demand, 8-12 times per day
        - **Proper positioning**: Ensure effective milk transfer
        
        **6-24 months (Complementary Feeding):**
        - **Timely introduction**: Start at 6 months, not before
        - **Adequate frequency**: 2-3 meals per day at 6-8 months, 3-4 meals at 9-24 months
        - **Food variety**: Include protein, fruits, vegetables, grains
        - **Food safety**: Clean preparation and storage
        - **Continued breastfeeding**: Up to 2 years or beyond
        
        **Community and Policy Level:**
        - **Access to clean water and sanitation**: Reduce infection risk
        - **Health education programs**: Nutrition and hygiene awareness
        - **Poverty reduction**: Economic empowerment of families
        - **Food fortification**: Adding nutrients to staple foods
        - **Social protection**: Cash transfers, food assistance programs
        """,
        "keywords": ["prevent", "avoid", "stop", "how to", "protection", "intervention"]
    },
    
    "treatment": {
        "title": "Treatment and Management of Stunting",
        "content": """
        While stunting is often irreversible after age 2-3, early intervention can improve outcomes:
        
        **1. Nutritional Rehabilitation:**
        - **High-protein, high-calorie diet**: 120-150% of normal requirements
        - **Micronutrient supplementation**: Iron, zinc, vitamin A, iodine
        - **Therapeutic feeding programs**: Ready-to-use therapeutic foods (RUTF)
        - **Frequent small meals**: 5-6 meals per day for better absorption
        
        **2. Medical Care:**
        - **Treatment of underlying infections**: Antibiotics, antiparasitics
        - **Management of complications**: Anemia, vitamin deficiencies
        - **Regular health monitoring**: Growth tracking, developmental assessment
        - **Immunization catch-up**: Complete vaccination schedule
        
        **3. Long-term Support:**
        - **Continued nutritional support**: Regular monitoring and supplementation
        - **Developmental monitoring**: Cognitive and motor development assessment
        - **Family education and counseling**: Nutrition, hygiene, care practices
        - **School readiness programs**: Early childhood development support
        
        **4. Special Considerations:**
        - **Severe acute malnutrition**: Requires immediate medical attention
        - **Chronic conditions**: HIV, tuberculosis, congenital disorders
        - **Family support**: Addressing social and economic barriers
        - **Community integration**: Reducing stigma and discrimination
        
        **Important Notes:**
        - Early intervention (before age 2) is crucial for better outcomes
        - Treatment requires long-term commitment and support
        - Prevention is more effective and cost-effective than treatment
        - Family and community involvement is essential for success
        """,
        "keywords": ["treat", "cure", "fix", "help", "management", "intervention", "therapy"]
    },
    
    "growth_monitoring": {
        "title": "Growth Monitoring and Assessment",
        "content": """
        Regular growth monitoring is essential for early detection and intervention:
        
        **Growth Charts:**
        - **WHO Growth Standards**: International reference for children 0-5 years
        - **Height-for-age**: Primary indicator for stunting
        - **Weight-for-height**: Indicator of acute malnutrition
        - **Head circumference**: Brain development indicator
        
        **Measurement Frequency:**
        - **Birth to 6 months**: Monthly measurements
        - **6-12 months**: Every 2 months
        - **1-2 years**: Every 3 months
        - **2-5 years**: Every 6 months
        
        **Red Flags:**
        - **Falling growth curves**: Crossing percentiles downward
        - **Height-for-age < -2 SD**: Moderate stunting
        - **Height-for-age < -3 SD**: Severe stunting
        - **No height gain**: For 3+ months
        
        **Assessment Tools:**
        - **Mid-upper arm circumference (MUAC)**: Quick screening tool
        - **Body mass index (BMI)**: For older children
        - **Developmental milestones**: Motor, cognitive, social skills
        """,
        "keywords": ["growth", "monitoring", "measurement", "assessment", "chart", "percentile"]
    },
    
    "nutrition_guidelines": {
        "title": "Nutrition Guidelines for Prevention",
        "content": """
        Evidence-based nutrition recommendations for preventing stunting:
        
        **Pregnancy Nutrition:**
        - **Calories**: Additional 300-500 kcal/day in 2nd and 3rd trimesters
        - **Protein**: 1.1 g/kg body weight (vs 0.8 g/kg normally)
        - **Iron**: 30 mg/day supplementation
        - **Folate**: 400-800 mcg/day
        - **Calcium**: 1000-1300 mg/day
        
        **Infant Feeding (0-6 months):**
        - **Exclusive breastfeeding**: No other foods or liquids
        - **Frequency**: 8-12 times per day, on demand
        - **Duration**: 6 months minimum
        - **Maternal nutrition**: Ensure adequate intake for milk production
        
        **Complementary Feeding (6-24 months):**
        - **Start at 6 months**: Not before, not after
        - **Food groups**: Grains, legumes, meat/fish, dairy, fruits, vegetables
        - **Texture progression**: Puree → mashed → chopped → finger foods
        - **Iron-rich foods**: Meat, fish, fortified cereals, legumes
        - **Vitamin A sources**: Orange/yellow fruits and vegetables
        
        **Key Nutrients:**
        - **Protein**: 1.6 g/kg/day for 6-12 months, 1.2 g/kg/day for 1-3 years
        - **Iron**: 11 mg/day for 7-12 months, 7 mg/day for 1-3 years
        - **Zinc**: 3 mg/day for 7-12 months, 3 mg/day for 1-3 years
        - **Vitamin A**: 400-500 mcg/day
        """,
        "keywords": ["nutrition", "diet", "feeding", "breastfeeding", "complementary", "nutrients"]
    },
    
    "risk_factors": {
        "title": "Risk Factors for Stunting",
        "content": """
        Understanding risk factors helps identify children who need extra attention:
        
        **Individual Risk Factors:**
        - **Low birth weight**: <2.5 kg at birth
        - **Prematurity**: Born before 37 weeks gestation
        - **Multiple births**: Twins, triplets
        - **Congenital conditions**: Heart defects, genetic disorders
        - **Frequent infections**: Diarrhea, respiratory infections
        
        **Family Risk Factors:**
        - **Low socioeconomic status**: Poverty, food insecurity
        - **Large family size**: Many children, short birth intervals
        - **Maternal education**: Less than secondary education
        - **Single parent household**: Limited support and resources
        - **Family history**: Stunting in siblings or parents
        
        **Community Risk Factors:**
        - **Rural residence**: Limited access to healthcare and markets
        - **Poor infrastructure**: Inadequate water, sanitation, roads
        - **Limited healthcare**: Few facilities, long travel distances
        - **Food insecurity**: Seasonal shortages, price fluctuations
        - **Natural disasters**: Droughts, floods, conflicts
        
        **Environmental Risk Factors:**
        - **Climate change**: Affecting food production and security
        - **Water scarcity**: Limited access to clean water
        - **Air pollution**: Respiratory health impacts
        - **Vector-borne diseases**: Malaria, dengue fever
        """,
        "keywords": ["risk", "factor", "vulnerable", "high risk", "susceptible", "at risk"]
    },
    
    "early_warning_signs": {
        "title": "Early Warning Signs of Stunting",
        "content": """
        Recognizing early warning signs enables timely intervention:
        
        **Physical Signs:**
        - **Slow growth**: Not gaining height as expected
        - **Small for age**: Consistently below growth chart percentiles
        - **Delayed milestones**: Sitting, standing, walking later than peers
        - **Poor muscle tone**: Weak, floppy appearance
        - **Thin extremities**: Arms and legs appear thin
        
        **Behavioral Signs:**
        - **Decreased activity**: Less playful, more tired
        - **Poor appetite**: Not interested in food
        - **Frequent crying**: Irritable, difficult to console
        - **Sleep problems**: Difficulty sleeping or excessive sleep
        - **Social withdrawal**: Less interaction with others
        
        **Developmental Delays:**
        - **Motor skills**: Late to roll, sit, crawl, walk
        - **Language**: Delayed speech development
        - **Social skills**: Poor eye contact, limited social interaction
        - **Cognitive**: Difficulty learning new skills
        
        **When to Seek Help:**
        - **No height gain**: For 3+ consecutive months
        - **Falling growth curve**: Crossing percentiles downward
        - **Multiple delays**: Physical, cognitive, and social
        - **Family concern**: Parents notice something is wrong
        - **Risk factors present**: Multiple risk factors identified
        """,
        "keywords": ["warning", "sign", "symptom", "early", "detection", "recognition"]
    }
}

def detect_language(user_message):
    """Detect if the user message is in Indonesian or English"""
    # Simple language detection based on common Indonesian words
    indonesian_words = [
        'apa', 'bagaimana', 'kenapa', 'mengapa', 'kapan', 'dimana', 'siapa',
        'stunting', 'pendek', 'kerdil', 'pendek', 'nutrisi', 'gizi', 'makanan',
        'bayi', 'anak', 'ibu', 'hamil', 'kehamilan', 'menyusui', 'asi',
        'tinggi', 'berat', 'pertumbuhan', 'perkembangan', 'pencegahan',
        'pengobatan', 'penyebab', 'gejala', 'tanda', 'risiko', 'faktor'
    ]
    
    user_message_lower = user_message.lower()
    indonesian_count = sum(1 for word in indonesian_words if word in user_message_lower)
    
    # If more than 2 Indonesian words found, assume Indonesian
    if indonesian_count >= 2:
        return 'indonesian'
    else:
        return 'english'

def get_knowledge_response(user_message):
    """Get appropriate knowledge base response based on user query and language"""
    language = detect_language(user_message)
    
    if language == 'indonesian':
        return get_indonesian_response(user_message)
    else:
        return get_english_response(user_message)

def get_indonesian_response(user_message):
    """Get response from Indonesian knowledge base"""
    user_message_lower = user_message.lower()
    
    # Check each knowledge category for relevant keywords
    for category, info in STUNTING_KNOWLEDGE_ID.items():
        if any(keyword in user_message_lower for keyword in info["keywords"]):
            return info["content"]
    
    # If no specific match, provide general information in Indonesian
    return """
    Saya dapat membantu Anda dengan informasi komprehensif tentang stunting. Berikut adalah topik utama yang dapat saya bahas:
    
    **📚 Topik yang Tersedia:**
    - **Apa itu stunting?** - Definisi, karakteristik, dan dampak global
    - **Penyebab** - Faktor nutrisi, lingkungan, maternal, dan perawatan kesehatan
    - **Pencegahan** - Strategi untuk berbagai tahap kehidupan
    - **Pengobatan** - Pendekatan penanganan dan intervensi
    - **Pemantauan pertumbuhan** - Alat penilaian dan frekuensi
    - **Panduan nutrisi** - Rekomendasi berbasis bukti
    - **Faktor risiko** - Risiko individual, keluarga, dan komunitas
    - **Tanda peringatan dini** - Pengenalan dan kapan mencari bantuan
    
    **💡 Coba tanyakan tentang:**
    - "Apa penyebab stunting?"
    - "Bagaimana mencegah stunting?"
    - "Apa tanda peringatan dini?"
    - "Apa yang harus saya berikan kepada bayi 6 bulan untuk mencegah stunting?"
    - "Seberapa sering saya harus mengukur pertumbuhan anak saya?"
    
    Silakan ajukan pertanyaan spesifik tentang topik-topik ini!
    """

def get_english_response(user_message):
    """Get response from English knowledge base"""
    user_message_lower = user_message.lower()
    
    # Check each knowledge category for relevant keywords
    for category, info in STUNTING_KNOWLEDGE.items():
        if any(keyword in user_message_lower for keyword in info["keywords"]):
            return info["content"]
    
    # If no specific match, provide general information
    return """
    I can help you with comprehensive information about stunting. Here are the main topics I can cover:
    
    **📚 Available Topics:**
    - **What is stunting?** - Definition, characteristics, and global impact
    - **Causes** - Nutritional, environmental, maternal, and healthcare factors
    - **Prevention** - Strategies for different life stages
    - **Treatment** - Management approaches and interventions
    - **Growth monitoring** - Assessment tools and frequency
    - **Nutrition guidelines** - Evidence-based recommendations
    - **Risk factors** - Individual, family, and community risks
    - **Early warning signs** - Recognition and when to seek help
    
    **💡 Try asking about:**
    - "What causes stunting?"
    - "How can I prevent stunting?"
    - "What are the early warning signs?"
    - "What should I feed my 6-month-old baby to prevent stunting?"
    - "How often should I measure my child's growth?"
    
    Feel free to ask any specific question about these topics!
    """

def get_knowledge_summary():
    """Get a summary of all available knowledge topics in both languages"""
    summary = "**📚 Complete Stunting Knowledge Base (English & Indonesian):**\n\n"
    
    summary += "**🇮🇩 Indonesian Topics:**\n"
    for category, info in STUNTING_KNOWLEDGE_ID.items():
        summary += f"- {info['title']}\n"
    
    summary += "\n**🇺🇸 English Topics:**\n"
    for category, info in STUNTING_KNOWLEDGE.items():
        summary += f"- {info['title']}\n"
    
    return summary

def search_knowledge(query, language='auto'):
    """Search knowledge base for specific terms in specified language"""
    if language == 'auto':
        language = detect_language(query)
    
    query_lower = query.lower()
    results = []
    
    if language == 'indonesian':
        knowledge_base = STUNTING_KNOWLEDGE_ID
    else:
        knowledge_base = STUNTING_KNOWLEDGE
    
    for category, info in knowledge_base.items():
        # Check if query matches title, content, or keywords
        if (query_lower in info["title"].lower() or 
            query_lower in info["content"].lower() or
            any(query_lower in keyword for keyword in info["keywords"])):
            results.append({
                "category": category,
                "title": info["title"],
                "content": info["content"][:200] + "...",
                "relevance": "high" if query_lower in info["title"].lower() else "medium",
                "language": language
            })
    
    return results

if __name__ == "__main__":
    # Test the knowledge base
    print("Stunting Knowledge Base Module")
    print("=" * 40)
    print(get_knowledge_summary())
    
    # Test language detection
    test_messages = [
        "Apa itu stunting?",
        "What is stunting?",
        "Bagaimana mencegah stunting?",
        "How to prevent stunting?"
    ]
    
    for msg in test_messages:
        lang = detect_language(msg)
        print(f"'{msg}' -> {lang}")
